//
//  main.cpp
//  HW6
//
//  Created by Nick Chung on 3/9/21.
//

#include <iostream>
#include <cmath>
#include <iomanip>

using namespace std;

long double dataArray[132] = {
8.96502741169389, 7.99307939270296, 7.50618700064592, 8.31936483400653, 8.16000363297781,
9.48596492102406, 8.60432956668047, 7.22063402384452, 5.56528561216769, 4.99094270765816,
6.1939104888744, 9.52691518571529, 3.83141931631935, 6.33286678884125, 6.72129130353404,
6.15205994971555, 6.92969464725852, 7.48458426860974, 8.52281995922686, 5.65429147877548,
3.98902101635156, 9.30292323457482, 5.86407570768347, 6.37620371040936, 9.19059243853496,
5.50695950072432, 5.90279466379915, 7.04118890121276, 7.65264611157413, 5.11320322114362,
4.08671258821798, 5.21101746926754, 8.91631215336855, 7.72720557029029, 6.12346153871479,
5.27520611217443, 5.18779606436965, 5.40573252903279, 3.82117928251942, 6.88571955834375,
5.81716602140618, 3.94978546593357, 4.08192873425081, 4.90344204950392, 4.12367197677108,
7.93147187073943, 7.0015480446586, 7.64633546385133, 7.7171521322726, 4.81999718606218,
7.04559305929355, 5.20511588474041, 3.62225016763534, 5.21536927610347, 4.34638658944099,
5.20369837207553, 4.58942879127778, 4.9050232358313, 5.29415769469651, 7.73087853766603,
4.20272479488544, 4.90228161481721, 8.45287477517804, 6.45848077535337, 4.8584487278304,
5.47290940115512, 5.63315659235971, 8.05607140662602, 5.16210109512355, 5.48893239362074,
4.28392506836956, 4.33172565872667, 6.06543608810201, 7.48002761905186, 6.2282113840515,
7.66478446177488, 8.30266813778736, 5.02252977613106, 4.49488827567951, 4.25210393910236,
4.99694670229041, 4.76861742059559, 4.34136516176091, 3.96383620432412, 4.4678117362787,
9.38784439658022, 7.64094185852322, 4.36304317015303, 4.60992740676778, 4.90259053886136,
7.93414703154611, 8.49756972134769, 5.64112453137221, 6.02834814728898, 4.22866768665274,
6.23957127190493, 7.34853409398769, 9.595759115507, 5.53027300020618, 8.87210089686254,
5.020813951422, 10.1094837077728, 4.07308366236743, 7.1708553923638, 5.09816846585742,
5.05353630897073, 4.65165556763063, 4.20131789988773, 8.99845655428687, 8.67289530906567,
5.54459127391317, 4.65643631847399, 6.62281158891638, 4.27768518693291, 5.00686418719675,
6.60011534349835, 5.81752922594547, 7.45665923293621, 6.29567518063715, 7.60851996715322,
4.66173369226443, 6.51495389368405, 5.19865605430494, 7.54795673769965, 5.11789261422162,
6.029935430191, 9.38229410490464, 5.01570824116142, 5.0381958483001, 4.77386201614782,
9.51554514185695, 5.30007172090036,
};

double pdf(double s, double m, double x) {
    double first = 1 / (sqrt(2 * 3.1415926 * pow(s, 2)));
    double second = - pow(x - m, 2) / (2 * pow(s, 2));
    
    return first * pow(sqrt(2), second);
}

double a_ij(double p1, double p2, double s1, double s2, double m1, double m2, double x) {
    
    double first = p1 * pdf(s1, m1, x);
    double sum = first + (p2 * pdf(s2, m2, x));
    
    return first / sum;
}

int main() {
    double p1 = 0.6, p2 = 0.4;
    double m1 = 5.6, m2 = 4.5;
    double s1 = 1.05, s2 = 0.95;
    
    double p1t1 = 0, p2t1 = 0, m1t1 = 0, m2t1 = 0, s1t1 = 0, s2t1 = 0;
    
    int iteration = 1;
    
    for (;;) {
        // p1t1
        double p1_num = 0;
        for (int j = 0; j < 132; j++) {
            p1_num += a_ij(p1, p2, s1, s2, m1, m2, dataArray[j]);
        }
        p1t1 = p1_num / 132;
        // m1t1
        double m1_num = 0, m1_den = 0;
        for (int j = 0; j < 132; j++) {
            m1_num += (a_ij(p1, p2, s1, s2, m1, m2, dataArray[j]) * dataArray[j]);
            m1_den += a_ij(p1, p2, s1, s2, m1, m2, dataArray[j]);
        }
        m1t1 = m1_num / m1_den;
        // s1t1
        double s1_num = 0, s1_den = 0;
        for (int j = 0; j < 132; j++) {
            s1_num += (a_ij(p1, p2, s1, s2, m1, m2, dataArray[j]) * pow(dataArray[j] - m1t1, 2));
            s1_den += a_ij(p1, p2, s1, s2, m1, m2, dataArray[j]);
        }
        s1t1 = sqrt(s1_num / s1_den);
        
        // p2t1
        double p2_num = 0;
        for (int j = 0; j < 132; j++) {
            p2_num += a_ij(p2, p1, s2, s1, m2, m1, dataArray[j]);
        }
        p2t1 = p2_num / 132;
        // m2t1
        double m2_num = 0, m2_den = 0;
        for (int j = 0; j < 132; j++) {
            m2_num += (a_ij(p2, p1, s2, s1, m2, m1, dataArray[j]) * dataArray[j]);
            m2_den += a_ij(p2, p1, s2, s1, m2, m1, dataArray[j]);
        }
        m2t1 = m2_num / m2_den;
        // s2t1
        double s2_num = 0, s2_den = 0;
        for (int j = 0; j < 132; j++) {
            s2_num += (a_ij(p2, p1, s2, s1, m2, m1, dataArray[j]) * pow(dataArray[j] - m2t1, 2));
            s2_den += a_ij(p2, p1, s2, s1, m2, m1, dataArray[j]);
        }
        s2t1 = sqrt(s2_num / s2_den);
        
        //stopping condition
        if (abs(p1t1 - p1) <= pow(10, -6)) {
            cout << "stopped at iteration: " << iteration << endl;
            break;
        }
        
        p1 = p1t1;
        p2 = p2t1;
        m1 = m1t1;
        m2 = m2t1;
        s1 = s1t1;
        s2 = s2t1;
        
        iteration++;
    }
    
    cout << setprecision(10) << "p1: " << p1t1 << " | m1: " << m1t1 << " | s1: " << s1t1 << endl;
    cout << "p2: " << p2t1 << " | m2: " << m2t1 << " | s2: " << s2t1 << endl;
    
    return 0;
}
